"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Scope = void 0;
class Scope {
    constructor(bundle, errors, args) {
        /** The bundle for which the given resolution is happening. */
        Object.defineProperty(this, "bundle", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        /** The list of errors collected while resolving. */
        Object.defineProperty(this, "errors", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        /** A dict of developer-provided variables. */
        Object.defineProperty(this, "args", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        /** The Set of patterns already encountered during this resolution.
         * Used to detect and prevent cyclic resolutions. */
        Object.defineProperty(this, "dirty", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: new WeakSet()
        });
        /** A dict of parameters passed to a TermReference. */
        Object.defineProperty(this, "params", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: null
        });
        /** The running count of placeables resolved so far. Used to detect the
         * Billion Laughs and Quadratic Blowup attacks. */
        Object.defineProperty(this, "placeables", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: 0
        });
        this.bundle = bundle;
        this.errors = errors;
        this.args = args;
    }
    reportError(error) {
        if (!this.errors || !(error instanceof Error)) {
            throw error;
        }
        this.errors.push(error);
    }
    memoizeIntlObject(ctor, opts) {
        let cache = this.bundle._intls.get(ctor);
        if (!cache) {
            cache = {};
            this.bundle._intls.set(ctor, cache);
        }
        const id = JSON.stringify(opts);
        if (!cache[id]) {
            cache[id] = new ctor(this.bundle.locales, opts);
        }
        return cache[id];
    }
}
exports.Scope = Scope;
